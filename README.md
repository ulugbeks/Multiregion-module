# –ú–æ–¥—É–ª—å Multiregions –¥–ª—è OkayCMS 4.5.2

## üìã –û–ø–∏—Å–∞–Ω–∏–µ
–ú–æ–¥—É–ª—å –º—É–ª—å—Ç–∏—Ä–µ–≥–∏–æ–Ω–æ–≤ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–¥–¥–æ–º–µ–Ω—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π SEO-—Ç–µ–≥–æ–≤ –∏ —É—á–µ—Ç–æ–º —Å–∫–ª–æ–Ω–µ–Ω–∏–π —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞. –ö–∞–∂–¥—ã–π –≥–æ—Ä–æ–¥ –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–π –ø–æ–¥–¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, msk.gidro-butik.ru –¥–ª—è –ú–æ—Å–∫–≤—ã) —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ SEO-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–¥–æ–º–µ–Ω–∞–º–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–∫–ª–æ–Ω–µ–Ω–∏–π –Ω–∞–∑–≤–∞–Ω–∏–π –≥–æ—Ä–æ–¥–æ–≤
- ‚úÖ –ì–∏–±–∫–∏–µ SEO-—à–∞–±–ª–æ–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —à–∞–±–ª–æ–Ω–∞—Ö
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–¥–¥–æ–º–µ–Ω–∞ –ø–æ URL
- ‚úÖ –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –æ –≥–æ—Ä–æ–¥–µ –≤ —à–∞–±–ª–æ–Ω—ã Smarty

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è
```
Okay/Modules/OkayCMS/Multiregions/
‚îú‚îÄ‚îÄ Backend/
‚îÇ   ‚îú‚îÄ‚îÄ Controllers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MultiregionsAdmin.php     # –°–ø–∏—Å–æ–∫ –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ MultiregionAdmin.php      # –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–¥–æ–º–µ–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ Helpers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ BackendMultiregionsHelper.php
‚îÇ   ‚îú‚îÄ‚îÄ Requests/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ BackendMultiregionsRequest.php
‚îÇ   ‚îú‚îÄ‚îÄ design/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ html/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ multiregions.tpl      # –®–∞–±–ª–æ–Ω —Å–ø–∏—Å–∫–∞
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ multiregion.tpl       # –®–∞–±–ª–æ–Ω —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ lang/
‚îÇ       ‚îî‚îÄ‚îÄ ru.php                    # –Ø–∑—ã–∫–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ Entities/
‚îÇ   ‚îú‚îÄ‚îÄ SubdomainsEntity.php          # –°—É—â–Ω–æ—Å—Ç—å –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ SubdomainSeoEntity.php        # –°—É—â–Ω–æ—Å—Ç—å SEO-—à–∞–±–ª–æ–Ω–æ–≤
‚îú‚îÄ‚îÄ Frontend/
‚îÇ   ‚îî‚îÄ‚îÄ MultiregionsPlugin.php        # Frontend –ø–ª–∞–≥–∏–Ω
‚îú‚îÄ‚îÄ Helpers/
‚îÇ   ‚îú‚îÄ‚îÄ SubdomainDetector.php         # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–¥–¥–æ–º–µ–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ SeoProcessor.php              # –û–±—Ä–∞–±–æ—Ç–∫–∞ SEO
‚îÇ   ‚îî‚îÄ‚îÄ CityDeclension.php            # –°–∫–ª–æ–Ω–µ–Ω–∏—è –≥–æ—Ä–æ–¥–æ–≤
‚îú‚îÄ‚îÄ Init/
‚îÇ   ‚îú‚îÄ‚îÄ Init.php                      # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è
‚îÇ   ‚îî‚îÄ‚îÄ services.php                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
‚îî‚îÄ‚îÄ module.json                        # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª—è
```

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª—è
```bash
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –º–æ–¥—É–ª–µ–π
cd /–ø—É—Ç—å/–∫/—Å–∞–π—Ç—É/Okay/Modules/OkayCMS/

# –°–∫–∞—á–∞–π—Ç–µ –∏–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –º–æ–¥—É–ª—å
# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å: Okay/Modules/OkayCMS/Multiregions/
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
1. –ó–∞–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å OkayCMS
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **–ú–æ–¥—É–ª–∏**
3. –ù–∞–π–¥–∏—Ç–µ –º–æ–¥—É–ª—å **Multiregions**
4. –ù–∞–∂–º–∏—Ç–µ **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å**
5. –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ **–í–∫–ª—é—á–∏—Ç—å**

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .htaccess
–î–æ–±–∞–≤—å—Ç–µ –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ `RewriteEngine on` –≤ –∫–æ—Ä–Ω–µ–≤–æ–º `.htaccess`:

```apache
# ===== MULTIREGIONS MODULE START =====
# –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤ –¥–ª—è –º—É–ª—å—Ç–∏—Ä–µ–≥–∏–æ–Ω–æ–≤
RewriteCond %{QUERY_STRING} !subdomain_city=
RewriteCond %{HTTP_HOST} ^([a-z0-9-]+)\.gidro-butik\.ru$ [NC]
RewriteCond %1 !^(www|mail|ftp|admin|api|dev)$ [NC]
RewriteRule ^(.*)$ $1?subdomain_city=%1 [QSA,DPI]
# ===== MULTIREGIONS MODULE END =====
```

**–í–∞–∂–Ω–æ:** –ó–∞–º–µ–Ω–∏—Ç–µ `gidro-butik\.ru` –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω!

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS
–î–æ–±–∞–≤—å—Ç–µ wildcard A-–∑–∞–ø–∏—Å—å –¥–ª—è –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤:
```
*.–≤–∞—à-–¥–æ–º–µ–Ω.ru    A    IP_–≤–∞—à–µ–≥–æ_—Å–µ—Ä–≤–µ—Ä–∞
```
–ò–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≥–æ—Ä–æ–¥–∞ –æ—Ç–¥–µ–ª—å–Ω–æ:
```
msk.–≤–∞—à-–¥–æ–º–µ–Ω.ru   A    IP_–≤–∞—à–µ–≥–æ_—Å–µ—Ä–≤–µ—Ä–∞
spb.–≤–∞—à-–¥–æ–º–µ–Ω.ru   A    IP_–≤–∞—à–µ–≥–æ_—Å–µ—Ä–≤–µ—Ä–∞
```

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞

#### Apache
–í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞:
```apache
<VirtualHost *:80>
    ServerName –≤–∞—à-–¥–æ–º–µ–Ω.ru
    ServerAlias *.–≤–∞—à-–¥–æ–º–µ–Ω.ru
    DocumentRoot /–ø—É—Ç—å/–∫/—Å–∞–π—Ç—É
    # –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏...
</VirtualHost>
```

#### Nginx
```nginx
server {
    server_name –≤–∞—à-–¥–æ–º–µ–Ω.ru *.–≤–∞—à-–¥–æ–º–µ–Ω.ru;
    root /–ø—É—Ç—å/–∫/—Å–∞–π—Ç—É;
    # –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏...
}
```

### 6. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ index.php
–î–æ–±–∞–≤—å—Ç–µ –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ `$modules->startEnabledModules();` (–æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫–∏ 74):

```php
// ===== MULTIREGIONS MODULE INITIALIZATION START =====
if (class_exists('Okay\Modules\OkayCMS\Multiregions\Frontend\MultiregionsPlugin')) {
    try {
        if (!preg_match('~^/?backend~', $_SERVER['REQUEST_URI'])) {
            $multiregionsPlugin = new \Okay\Modules\OkayCMS\Multiregions\Frontend\MultiregionsPlugin();
            $GLOBALS['multiregions_plugin'] = $multiregionsPlugin;
        }
    } catch (\Exception $e) {
        if ($config->get('debug_mode') == true) {
            error_log('Multiregions plugin initialization error: ' . $e->getMessage());
        }
    }
}
// ===== MULTIREGIONS MODULE INITIALIZATION END =====
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–¥—É–ª—è

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–¥–æ–º–µ–Ω–∞
1. –í –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ú—É–ª—å—Ç–∏—Ä–µ–≥–∏–æ–Ω—ã**
2. –ù–∞–∂–º–∏—Ç–µ **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–æ–º–µ–Ω**
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è:
   - **–ü–æ–¥–¥–æ–º–µ–Ω**: –Ω–∞–ø—Ä–∏–º–µ—Ä, `msk` (—Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω–∏—Ü–∞ –∏ –¥–µ—Ñ–∏—Å)
   - **–ì–æ—Ä–æ–¥**: –Ω–∞–ø—Ä–∏–º–µ—Ä, `–ú–æ—Å–∫–≤–∞`
   - **–ê–∫—Ç–∏–≤–µ–Ω**: –≤–∫–ª—é—á–∏—Ç–µ –≥–∞–ª–æ—á–∫—É

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∫–ª–æ–Ω–µ–Ω–∏–π
–ù–∞–∂–º–∏—Ç–µ **–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –∏–ª–∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Ä—É—á–Ω—É—é:
- **–ò–º–µ–Ω–∏—Ç–µ–ª—å–Ω—ã–π**: –ú–æ—Å–∫–≤–∞ (–∫—Ç–æ? —á—Ç–æ?)
- **–†–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π**: –ú–æ—Å–∫–≤—ã (–∫–æ–≥–æ? —á–µ–≥–æ?)
- **–î–∞—Ç–µ–ª—å–Ω—ã–π**: –ú–æ—Å–∫–≤–µ (–∫–æ–º—É? —á–µ–º—É?)
- **–í–∏–Ω–∏—Ç–µ–ª—å–Ω—ã–π**: –ú–æ—Å–∫–≤—É (–∫–æ–≥–æ? —á—Ç–æ?)
- **–¢–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–π**: –ú–æ—Å–∫–≤–æ–π (–∫–µ–º? —á–µ–º?)
- **–ü—Ä–µ–¥–ª–æ–∂–Ω—ã–π**: –ú–æ—Å–∫–≤–µ (–æ –∫–æ–º? –æ —á—ë–º? –≥–¥–µ?)

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SEO-—à–∞–±–ª–æ–Ω–æ–≤
–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–≤–æ–∏ —à–∞–±–ª–æ–Ω—ã:

#### –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
```
Meta Title: –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω —Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∏ –≤ {city_prepositional} - {site_name}
Meta Description: –ö—É–ø–∏—Ç—å —Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫—É –≤ {city_prepositional} —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π. ‚úì –ë–æ–ª—å—à–æ–π –≤—ã–±–æ—Ä ‚úì –ù–∏–∑–∫–∏–µ —Ü–µ–Ω—ã
H1: –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω —Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∏ –≤ {city_prepositional}
```

#### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
```
Meta Title: {category} –≤ {city_prepositional} - –∫—É–ø–∏—Ç—å –ø–æ –Ω–∏–∑–∫–∏–º —Ü–µ–Ω–∞–º | {site_name}
Meta Description: {category} –≤ {city_prepositional} —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π. –ë–æ–ª—å—à–æ–π –≤—ã–±–æ—Ä, –Ω–∏–∑–∫–∏–µ —Ü–µ–Ω—ã.
H1: {category} –≤ {city_prepositional}
```

#### –°—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–æ–≤
```
Meta Title: {product} –∫—É–ø–∏—Ç—å –≤ {city_prepositional} - —Ü–µ–Ω–∞ {price} —Ä—É–± | {site_name}
Meta Description: –ö—É–ø–∏—Ç—å {product} –≤ {city_prepositional}. ‚úì –í –Ω–∞–ª–∏—á–∏–∏ ‚úì –î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ {city_dative}
```

## üìù –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≥–æ—Ä–æ–¥–∞
| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------------|----------|--------|
| `{city}` | –ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ | –ú–æ—Å–∫–≤–∞ |
| `{city_nominative}` | –ò–º–µ–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–∞–¥–µ–∂ | –ú–æ—Å–∫–≤–∞ |
| `{city_genitive}` | –†–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø–∞–¥–µ–∂ | –ú–æ—Å–∫–≤—ã |
| `{city_dative}` | –î–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞–¥–µ–∂ | –ú–æ—Å–∫–≤–µ |
| `{city_accusative}` | –í–∏–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–∞–¥–µ–∂ | –ú–æ—Å–∫–≤—É |
| `{city_instrumental}` | –¢–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø–∞–¥–µ–∂ | –ú–æ—Å–∫–≤–æ–π |
| `{city_prepositional}` | –ü—Ä–µ–¥–ª–æ–∂–Ω—ã–π –ø–∞–¥–µ–∂ | –ú–æ—Å–∫–≤–µ |
| `{in_city}` | –í –≥–æ—Ä–æ–¥–µ | –≤ –ú–æ—Å–∫–≤–µ |
| `{from_city}` | –ò–∑ –≥–æ—Ä–æ–¥–∞ | –∏–∑ –ú–æ—Å–∫–≤—ã |
| `{to_city}` | –í –≥–æ—Ä–æ–¥ | –≤ –ú–æ—Å–∫–≤—É |

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ì–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∞ |
|------------|----------|--------------|
| `{category}` | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ | –°—Ç—Ä–∞–Ω–∏—Ü—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π |
| `{product}` | –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ | –°—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–æ–≤ |
| `{price}` | –¶–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞ | –°—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–æ–≤ |
| `{brand}` | –ù–∞–∑–≤–∞–Ω–∏–µ –±—Ä–µ–Ω–¥–∞ | –°—Ç—Ä–∞–Ω–∏—Ü—ã –±—Ä–µ–Ω–¥–æ–≤ |
| `{site_name}` | –ù–∞–∑–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞ | –í–µ–∑–¥–µ |

## üé® –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —à–∞–±–ª–æ–Ω–∞—Ö

–í —à–∞–±–ª–æ–Ω–∞—Ö Smarty –¥–æ—Å—Ç—É–ø–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```smarty
{* –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø–æ–¥–¥–æ–º–µ–Ω–∞ *}
{if $current_subdomain}
    <p>–í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –≥–æ—Ä–æ–¥–µ: {$current_city}</p>
    <p>–î–æ—Å—Ç–∞–≤–∫–∞ {$city_cases.in_city}</p>
    <p>–î–æ—Å—Ç–∞–≤–∫–∞ {$city_cases.from_city}</p>
{/if}

{* –í—Å–µ —Å–∫–ª–æ–Ω–µ–Ω–∏—è *}
{if $city_cases}
    –ò–º–µ–Ω–∏—Ç–µ–ª—å–Ω—ã–π: {$city_cases.nominative}
    –†–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π: {$city_cases.genitive}
    –î–∞—Ç–µ–ª—å–Ω—ã–π: {$city_cases.dative}
    –í–∏–Ω–∏—Ç–µ–ª—å–Ω—ã–π: {$city_cases.accusative}
    –¢–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–π: {$city_cases.instrumental}
    –ü—Ä–µ–¥–ª–æ–∂–Ω—ã–π: {$city_cases.prepositional}
    –í –≥–æ—Ä–æ–¥–µ: {$city_cases.in_city}
{/if}
```

## üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: HTTP 500 –æ—à–∏–±–∫–∞
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫ PHP
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ñ–∞–π–ª—ã –º–æ–¥—É–ª—è –Ω–∞ –º–µ—Å—Ç–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (755 –¥–ª—è –ø–∞–ø–æ–∫, 644 –¥–ª—è —Ñ–∞–π–ª–æ–≤)
4. –û—Ç–∫–ª—é—á–∏—Ç–µ –≤—ã–≤–æ–¥ –æ—à–∏–±–æ–∫ –≤ index.php (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ `error_reporting(E_ALL)`)

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–¥–¥–æ–º–µ–Ω –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS –∑–∞–ø–∏—Å–∏: `nslookup msk.–≤–∞—à-–¥–æ–º–µ–Ω.ru`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ (ServerAlias –¥–ª—è Apache)
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ .htaccess –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–¥–¥–æ–º–µ–Ω –∞–∫—Ç–∏–≤–µ–Ω –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

### –ü—Ä–æ–±–ª–µ–º–∞: SEO-—Ç–µ–≥–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ SEO-—à–∞–±–ª–æ–Ω—ã –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –¥–ª—è –Ω—É–∂–Ω–æ–≥–æ —Ç–∏–ø–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
2. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à: `rm -rf compiled/* cache/*`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–¥–¥–æ–º–µ–Ω –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `$current_subdomain`)

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ "unknown tag 'multiregion_seo'"
**–†–µ—à–µ–Ω–∏–µ:**
–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è Smarty-–ø–ª–∞–≥–∏–Ω–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è inline SEO –≤ —à–∞–±–ª–æ–Ω–∞—Ö.
–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ - —É–¥–∞–ª–∏—Ç—å –≤—ã–∑–æ–≤—ã `{multiregion_seo}` –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤.

### –ü—Ä–æ–±–ª–µ–º–∞: Warnings about missing files
**–†–µ—à–µ–Ω–∏–µ:**
–ï—Å–ª–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–∞—Ö –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª–µ–π:
1. –°–æ–∑–¥–∞–π—Ç–µ –ø—É—Å—Ç—ã–µ —Ñ–∞–π–ª—ã-–∑–∞–≥–ª—É—à–∫–∏
2. –ò–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–æ–¥—É–ª–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

## üìä –¢–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ ok_subdomains
```sql
CREATE TABLE `ok_subdomains` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `subdomain` varchar(50) NOT NULL,
  `city_name` varchar(100) NOT NULL,
  `city_nominative` varchar(100) DEFAULT NULL,
  `city_genitive` varchar(100) DEFAULT NULL,
  `city_dative` varchar(100) DEFAULT NULL,
  `city_accusative` varchar(100) DEFAULT NULL,
  `city_instrumental` varchar(100) DEFAULT NULL,
  `city_prepositional` varchar(100) DEFAULT NULL,
  `enabled` tinyint(1) DEFAULT 1,
  `position` int(11) DEFAULT 0,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `subdomain` (`subdomain`)
);
```

### –¢–∞–±–ª–∏—Ü–∞ ok_subdomain_seo
```sql
CREATE TABLE `ok_subdomain_seo` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `subdomain_id` int(11) NOT NULL,
  `page_type` varchar(50) NOT NULL,
  `meta_title_pattern` text DEFAULT NULL,
  `meta_description_pattern` text DEFAULT NULL,
  `meta_keywords_pattern` text DEFAULT NULL,
  `h1_pattern` text DEFAULT NULL,
  `description_pattern` text DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `subdomain_page` (`subdomain_id`, `page_type`)
);
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –º–æ–¥—É–ª—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–¥–¥–æ–º–µ–Ω–∞
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `test_subdomain.php` –≤ –∫–æ—Ä–Ω–µ —Å–∞–π—Ç–∞:
```php
<?php
echo "Host: " . $_SERVER['HTTP_HOST'] . "<br>";
echo "Subdomain GET param: " . ($_GET['subdomain_city'] ?? 'not set') . "<br>";
```

–û—Ç–∫—Ä–æ–π—Ç–µ `https://msk.–≤–∞—à-–¥–æ–º–µ–Ω.ru/test_subdomain.php` –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è.

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —à–∞–±–ª–æ–Ω–µ
–î–æ–±–∞–≤—å—Ç–µ –≤ —à–∞–±–ª–æ–Ω –≤—Ä–µ–º–µ–Ω–Ω–æ:
```smarty
{if $current_subdomain}
    <div style="background: green; color: white; padding: 10px;">
        –ü–æ–¥–¥–æ–º–µ–Ω –∞–∫—Ç–∏–≤–µ–Ω: {$current_city}
    </div>
{/if}
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ú—É–ª—å—Ç–∏—Ä–µ–≥–∏–æ–Ω—ã**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–¥–¥–æ–º–µ–Ω —Å–æ–∑–¥–∞–Ω –∏ –∞–∫—Ç–∏–≤–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ SEO-—à–∞–±–ª–æ–Ω—ã –∑–∞–ø–æ–ª–Ω–µ–Ω—ã

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è SEO
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ meta-—Ç–µ–≥–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≥–æ—Ä–æ–¥–∞
2. –î–æ–±–∞–≤–ª—è–π—Ç–µ –≥–æ—Ä–æ–¥ –≤ H1 –∑–∞–≥–æ–ª–æ–≤–∫–∏
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–∫–ª–æ–Ω–µ–Ω–∏—è –¥–ª—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ —Ç–µ–∫—Å—Ç–∞
4. –°–æ–∑–¥–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –≥–ª–∞–≤–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
1. –†–µ–≥—É–ª—è—Ä–Ω–æ –æ—á–∏—â–∞–π—Ç–µ –∫—ç—à –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
2. –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ CDN –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
1. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–º–∏ –≥–æ—Ä–æ–¥–∞–º–∏
2. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤
3. –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –º–æ–¥—É–ª—å

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫ –≤ `/var/log/` –∏–ª–∏ –≤ –ø–∞–Ω–µ–ª–∏ —Ö–æ—Å—Ç–∏–Ω–≥–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–µ—Ä—Å–∏—è OkayCMS >= 4.5.0
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ú–æ–¥—É–ª—å —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT.

## üîÑ –ò—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π

### –í–µ—Ä—Å–∏—è 1.0.0 (2024)
- –ü–µ—Ä–≤—ã–π —Ä–µ–ª–∏–∑
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫–ª–æ–Ω–µ–Ω–∏—è
- SEO-—à–∞–±–ª–æ–Ω—ã
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OkayCMS 4.5.2

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

- [ ] –ú–æ–¥—É–ª—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –≤–∫–ª—é—á–µ–Ω –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
- [ ] .htaccess –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] DNS –∑–∞–ø–∏—Å–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã
- [ ] –í–µ–±-—Å–µ—Ä–≤–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤
- [ ] index.php –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω
- [ ] –°–æ–∑–¥–∞–Ω —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–æ–¥–¥–æ–º–µ–Ω
- [ ] SEO-—à–∞–±–ª–æ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –ö—ç—à –æ—á–∏—â–µ–Ω
- [ ] –ü–æ–¥–¥–æ–º–µ–Ω –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] SEO-—Ç–µ–≥–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

–°–ø–∞—Å–∏–±–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª—è Multiregions –¥–ª—è OkayCMS!