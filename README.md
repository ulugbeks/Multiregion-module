# Модуль Multiregions для OkayCMS 4.5.2

## Описание
Модуль мультирегионов позволяет создавать поддомены для разных городов с автоматической генерацией SEO-тегов с учетом склонений русского языка.

## Возможности
- ✅ Управление поддоменами через админ-панель
- ✅ Автоматическое склонение названий городов
- ✅ Гибкие SEO-шаблоны для каждого типа страниц
- ✅ Поддержка переменных в шаблонах
- ✅ Сохранение оригинальных SEO-тегов как fallback
- ✅ Drag&Drop сортировка поддоменов

## Установка

### 1. Загрузка модуля
1. Скачайте архив с модулем
2. Распакуйте в папку `Okay/Modules/OkayCMS/Multiregions/`
3. Структура должна быть:
```
Okay/Modules/OkayCMS/Multiregions/
├── Init/
│   ├── Init.php
│   └── Install.sql
├── Backend/
├── Entities/
├── Helpers/
├── Extenders/
└── module.json
```

### 2. Активация модуля
1. Зайдите в админ-панель OkayCMS
2. Перейдите в раздел "Модули"
3. Найдите модуль "Multiregions"
4. Нажмите "Установить"
5. После установки нажмите "Включить"

### 3. Настройка веб-сервера

#### Для Apache (.htaccess)
Добавьте в начало файла `.htaccess` в корне сайта:
```apache
# Поддержка поддоменов
RewriteCond %{HTTP_HOST} ^([a-z0-9-]+)\.gidro-butik\.ru$ [NC]
RewriteCond %{REQUEST_URI} !^/Okay/Modules/
RewriteRule ^(.*)$ index.php [L]
```

#### Для Nginx
```nginx
server {
    server_name ~^(?<subdomain>[a-z0-9-]+)\.gidro-butik\.ru$;
    root /path/to/your/okaycms;
    
    location / {
        try_files $uri $uri/ /index.php?$args;
    }
    
    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}
```

### 4. Настройка DNS
Добавьте wildcard A-запись для поддоменов:
```
*.gidro-butik.ru A 1.2.3.4
```
Где `1.2.3.4` - IP вашего сервера

## Использование

### Добавление поддомена
1. В админ-панели перейдите в "Мультирегионы"
2. Нажмите "Добавить поддомен"
3. Заполните:
   - **Поддомен**: например, `spb`
   - **Город**: например, `Санкт-Петербург`
4. Нажмите "Определить автоматически" для склонений
5. Настройте SEO-шаблоны для каждого типа страниц

### Переменные для SEO-шаблонов

#### Переменные города:
- `{city}` - название города (Москва)
- `{city_genitive}` - родительный падеж (Москвы)
- `{city_dative}` - дательный падеж (Москве)
- `{city_accusative}` - винительный падеж (Москву)
- `{city_instrumental}` - творительный падеж (Москвой)
- `{city_prepositional}` - предложный падеж (Москве)
- `{in_city}` - в городе (в Москве)
- `{from_city}` - из города (из Москвы)
- `{to_city}` - в город (в Москву)

#### Переменные контента:
- `{category}` - название категории
- `{product}` - название товара
- `{brand}` - название бренда
- `{price}` - цена товара
- `{site_name}` - название сайта

### Примеры SEO-шаблонов

**Главная страница:**
- Title: `{site_name} в {city_prepositional} - интернет-магазин сантехники`
- Description: `Купить сантехнику в {city_prepositional} с доставкой. ✓ Большой выбор ✓ Низкие цены`
- H1: `Интернет-магазин сантехники в {city_prepositional}`

**Категория товаров:**
- Title: `{category} в {city_prepositional} - купить по низким ценам | {site_name}`
- Description: `{category} в {city_prepositional} с доставкой. Большой выбор, низкие цены.`
- H1: `{category} в {city_prepositional}`

**Страница товара:**
- Title: `{product} купить в {city_prepositional} - цена {price} руб | {site_name}`
- Description: `Купить {product} в {city_prepositional}. Цена: {price} руб. Доставка по {city_dative}.`
- H1: `{product}`

## Проверка работы

1. После настройки поддомена перейдите по адресу: `http://spb.gidro-butik.ru`
2. Проверьте мета-теги в исходном коде страницы
3. Убедитесь, что H1 заголовки отображаются корректно

## Частые вопросы

**Q: Поддомен не открывается**
A: Проверьте:
- DNS записи (должна быть wildcard запись)
- Настройки веб-сервера
- Активен ли поддомен в админке

**Q: SEO-теги не меняются**
A: Убедитесь, что:
- Заполнены SEO-шаблоны для нужного типа страниц
- Поддомен активен
- Очистите кеш сайта

**Q: Склонения определяются неправильно**
A: Вы можете вручную исправить склонения во вкладке "Склонения" при редактировании поддомена

## Поддержка

При возникновении проблем:
1. Проверьте логи ошибок PHP
2. Убедитесь, что версия OkayCMS >= 4.5.0
3. Проверьте права доступа на папки

## Лицензия

Модуль распространяется под лицензией MIT.

## Автор

Разработано для OkayCMS 4.5.2